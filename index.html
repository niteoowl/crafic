<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAFIQ - HTML Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Pretendard Web Font Definitions */
        @font-face {
            font-family: 'Pretendard';
            src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'Pretendard';
            src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-SemiBold.woff') format('woff');
            font-weight: 600;
            font-style: normal;
        }
        @font-face {
            font-family: 'Pretendard';
            src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Bold.woff') format('woff');
            font-weight: 700;
            font-style: normal;
        }
        @font-face {
            font-family: 'Pretendard';
            src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-ExtraBold.woff') format('woff');
            font-weight: 800;
            font-style: normal;
        }

        /* Base font application */
        body {
            font-family: 'Pretendard', sans-serif;
        }

        /* Tailwind CSS Scrollbar Hide Utility (Optional, but good for aesthetics) */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Custom style for dropdown arrow rotation */
        .rotate-180 {
            transform: rotate(180deg);
        }
        .transition-transform {
            transition-property: transform;
            transition-duration: 300ms;
            transition-timing-function: ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800">

    <header id="main-header" class="fixed top-0 left-0 w-full z-50 py-3 transition-all duration-500 ease-in-out bg-transparent">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-extrabold transition-colors duration-500 text-white">
                CRAFIQ
            </a>

            <nav class="hidden md:flex space-x-6">
                <a href="#" class="text-sm font-semibold transition-colors duration-500 text-white hover:text-gray-300">
                    소개
                </a>
                <a href="#" class="text-sm font-semibold transition-colors duration-500 text-white hover:text-gray-300">
                    인기작품
                </a>
                <a href="#" class="text-sm font-semibold transition-colors duration-500 text-white hover:text-gray-300">
                    더빙/자막 선택
                </a>
                <a href="#" class="text-sm font-semibold transition-colors duration-500 text-white hover:text-gray-300">
                    팬심
                </a>
            </nav>

            <div class="flex items-center space-x-4">
                <button class="transition-colors duration-500 text-white hover:text-gray-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.3-4.3"></path>
                    </svg>
                </button>
                <div id="auth-section" class="flex items-center space-x-4">
                    <button id="login-signup-btn" class="px-4 py-2 rounded-full text-sm font-semibold transition-all duration-500 text-white border border-white hover:bg-white hover:text-teal-600">
                        로그인/회원가입
                    </button>
                    <div id="user-info-display" class="relative hidden items-center space-x-1">
                        <span id="user-nickname" class="text-sm font-semibold text-white"></span>
                        <button id="dropdown-toggle-btn" class="cursor-pointer p-1 rounded-full hover:bg-white/10 transition-colors">
                            <svg id="dropdown-arrow-icon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white transition-transform" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="user-dropdown-menu" class="absolute right-0 top-full mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-20">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">내 프로필</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">설정</a>
                            <button id="logout-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                로그아웃
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section id="hero-section" class="relative w-full h-[450px] md:h-[600px] bg-cover bg-center flex items-center overflow-hidden transition-all duration-500 ease-in-out">
            <div class="absolute inset-0 bg-gradient-to-r from-black/60 to-transparent"></div>
            <div class="absolute inset-0 bg-gradient-to-l from-black/10 to-transparent"></div> <button id="prev-banner-btn" class="absolute left-4 p-2 text-white bg-black bg-opacity-30 rounded-full hover:bg-opacity-50 transition-opacity z-10 md:block hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                    <path d="m15 18-6-6 6-6"></path>
                </svg>
            </button>

            <div id="banner-content" class="container mx-auto px-4 relative z-10 text-white text-left">
                <h1 class="text-4xl md:text-6xl font-extrabold leading-tight mb-4">
                    <span id="banner-title1"></span><br />
                    <span id="banner-title2" class="text-5xl md:text-7xl whitespace-nowrap"></span>
                </h1>
                <p id="banner-description" class="text-lg md:text-xl font-medium mb-6"></p>
                <button class="px-6 py-3 bg-white text-teal-600 font-bold rounded-md text-lg hover:bg-gray-100 transition-colors duration-300">
                    보러가기 &gt;
                </button>
            </div>

            <button id="next-banner-btn" class="absolute right-4 p-2 text-white bg-black bg-opacity-30 rounded-full hover:bg-opacity-50 transition-opacity z-10 md:block hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                    <path d="m9 18 6-6-6-6"></path>
                </svg>
            </button>

            <div id="pagination-dots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-10">
                </div>
        </section>

        <section class="container mx-auto px-4 py-8 mt-8">
            <h2 class="text-2xl md:text-3xl font-bold mb-6 text-gray-900">크래픽 인기 작품</h2>
            <div class="flex space-x-4 mb-6 border-b border-gray-200">
                <button id="tab-실시간" class="pb-2 text-lg font-semibold text-teal-600 border-b-2 border-teal-600 transition-colors duration-200" data-tab="실시간">
                    실시간
                </button>
                <button id="tab-이번 주" class="pb-2 text-lg font-semibold text-gray-600 hover:text-teal-600 transition-colors duration-200" data-tab="이번 주">
                    이번 주
                </button>
                <button id="tab-분기" class="pb-2 text-lg font-semibold text-gray-600 hover:text-teal-600 transition-colors duration-200" data-tab="분기">
                    분기
                </button>
                <button id="tab-역대" class="pb-2 text-lg font-semibold text-gray-600 hover:text-teal-600 transition-colors duration-200" data-tab="역대">
                    역대
                </button>
            </div>

            <div id="popular-anime-container" class="flex overflow-x-scroll scrollbar-hide space-x-4 pb-4">
                </div>
        </section>

        <section class="container mx-auto px-4 py-8">
            <h2 class="text-2xl md:text-3xl font-bold mb-6 text-gray-900">최신 작품</h2>
            <div id="exclusive-works-container" class="flex overflow-x-scroll scrollbar-hide space-x-4 pb-4">
                </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-gray-300 py-10 px-4 mt-12">
        <div class="container mx-auto text-center">
            <div class="mb-4">
                <a href="#" class="text-teal-400 hover:text-teal-300 mx-3 text-sm">이용약관</a>
                <span class="text-gray-600 text-sm">|</span>
                <a href="#" class="text-teal-400 hover:text-teal-300 mx-3 text-sm">개인정보처리방침</a>
                <span class="text-gray-600 text-sm">|</span>
                <a href="#" class="text-teal-400 hover:text-teal-300 mx-3 text-sm">문의하기</a>
            </div>
            <p class="text-xs">&copy; 2025 Crafiq. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration (replace with your actual config or load from environment)
        const firebaseConfig = JSON.parse(`{"apiKey": "AIzaSyBJFAV4-QMggAW2K1YtpsXIZ5PQ8KJzo9k", "authDomain": "crafiq-a.firebaseapp.com", "projectId": "crafiq-a", "storageBucket": "crafiq-a.firebasestorage.app", "messagingSenderId": "176082460783", "appId": "1:176082460783:web:cd0b594cc803932eaa2d9a", "measurementId": "G-QB84Z9EMZW"}`);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Use __app_id if available

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Dummy data for Hero Banners
        const heroBanners = [
            {
                id: 1,
                title1: '무면허힐러',
                title2: '즐겁게 살아가기',
                description: '오늘부터 치원 정상영업합니다!',
                imageUrl: 'https://placehold.co/1920x800/2D545E/FFFFFF?text=Your+Epic+Novel+Banner+1'
            },
            {
                id: 2,
                title1: '별빛 아래에서',
                title2: '새로운 시작',
                description: '꿈과 희망이 가득한 판타지 세계로 초대합니다!',
                imageUrl: 'https://placehold.co/1920x800/4CAF50/FFFFFF?text=Your+Epic+Novel+Banner+2'
            },
            {
                id: 3,
                title1: '도시의 그림자',
                title2: '숨겨진 이야기',
                description: '어둠 속에 감춰진 진실을 파헤쳐라!',
                imageUrl: 'https://placehold.co/1920x800/FF5722/FFFFFF?text=Your+Epic+Novel+Banner+3'
            }
        ];

        // Dummy data for "크래픽 인기 작품" section
        const popularAnime = [
            {
                id: 1,
                rank: 1,
                title: '덕선',
                description: '순간 치료 능력자인데 노움이 안 된다.',
                img: 'https://placehold.co/200x112/A0C49D/FFFFFF?text=Anime+1'
            },
            {
                id: 2,
                rank: 2,
                title: '윈브레 - WINBRE - 시즌 2',
                description: '추방당한 천재 치유사, 무면허 헐...',
                img: 'https://placehold.co/200x112/C4D7B2/FFFFFF?text=Anime+2'
            },
            {
                id: 3,
                rank: 3,
                title: '목은 숙녀의 소양이기에',
                description: '커타지 지유',
                img: 'https://placehold.co/200x112/E0A96D/FFFFFF?text=Anime+3'
            },
            {
                id: 4,
                rank: 4,
                title: '병아리 같은 남동생을 키웁니다.',
                description: '백돼지 귀족인데 전생의 기억이 떠돌',
                img: 'https://placehold.co/200x112/B8621B/FFFFFF?text=Anime+4'
            },
            {
                id: 5,
                rank: 5,
                title: '완벽해서 귀여운 구석이 없다고 파혼',
                description: '판타지 액션',
                img: 'https://placehold.co/200x112/5C8374/FFFFFF?text=Anime+5'
            },
            {
                id: 6,
                rank: 6,
                title: '진석의 거인 The FINAL part 1',
                description: '당한 성 너는 이웃 나라에 팔린다',
                img: 'https://placehold.co/200x112/183D3D/FFFFFF?text=Anime+6'
            },
            {
                id: 7,
                rank: 7,
                title: '유녀사',
                description: '환생한 김에 인생 갈아엎는다',
                img: 'https://placehold.co/200x112/93B1A6/FFFFFF?text=Anime+7'
            },
        ];

        // Dummy data for "최신 작품" section
        const exclusiveWorks = [
            {
                id: 1,
                title: '듀라라라!!x2 결 - 판권 부활',
                img: 'https://placehold.co/200x112/5C469C/FFFFFF?text=Exclusive+1'
            },
            {
                id: 2,
                title: '피라미드 게임',
                img: 'https://placehold.co/200x112/333A73/FFFFFF?text=Exclusive+2'
            },
            {
                id: 3,
                title: 'S.A 스페셜 에이',
                img: 'https://placehold.co/200x112/4E4F50/FFFFFF?text=Exclusive+3'
            },
            {
                id: 4,
                title: 'ID:INVADED',
                img: 'https://placehold.co/200x112/7C7F7F/FFFFFF?text=Exclusive+4'
            },
            {
                id: 5,
                title: 'A3!',
                img: 'https://placehold.co/200x112/9BABB8/FFFFFF?text=Exclusive+5'
            },
            {
                id: 6,
                title: '하늘색 유틸리티',
                img: 'https://placehold.co/200x112/B7B7B7/FFFFFF?text=Exclusive+6'
            },
            {
                id: 7,
                title: '유녀사',
                description: '환생한 김에 인생 갈아엎는다',
                img: 'https://placehold.co/200x112/DCDCDC/FFFFFF?text=Exclusive+7'
            },
        ];

        let currentBannerIndex = 0;
        let touchStartX = 0;
        let touchEndX = 0;
        let autoSlideInterval;

        // Get DOM elements
        const header = document.getElementById('main-header');
        const heroSection = document.getElementById('hero-section');
        const bannerTitle1 = document.getElementById('banner-title1');
        const bannerTitle2 = document.getElementById('banner-title2');
        const bannerDescription = document.getElementById('banner-description');
        const prevBannerBtn = document.getElementById('prev-banner-btn');
        const nextBannerBtn = document.getElementById('next-banner-btn');
        const paginationDotsContainer = document.getElementById('pagination-dots');
        const popularAnimeContainer = document.getElementById('popular-anime-container');
        const exclusiveWorksContainer = document.getElementById('exclusive-works-container');
        const tabButtons = document.querySelectorAll('.flex.space-x-4.mb-6 button');

        // Auth-related DOM elements
        const authSection = document.getElementById('auth-section'); // This now contains both login/signup and user info display
        const loginSignupBtn = document.getElementById('login-signup-btn');
        const userInfoDisplay = document.getElementById('user-info-display');
        const userNicknameSpan = document.getElementById('user-nickname');
        const dropdownToggleBtn = document.getElementById('dropdown-toggle-btn'); // Renamed from userNicknameContainer
        const dropdownArrowIcon = document.getElementById('dropdown-arrow-icon');
        const userDropdownMenu = document.getElementById('user-dropdown-menu');
        const logoutBtn = document.getElementById('logout-btn');

        /**
         * Renders the current banner content and updates styling.
         */
        function renderBanner() {
            const currentBanner = heroBanners[currentBannerIndex];
            heroSection.style.backgroundImage = `url("${currentBanner.imageUrl}")`;
            bannerTitle1.textContent = currentBanner.title1;
            bannerTitle2.textContent = currentBanner.title2;
            bannerDescription.textContent = currentBanner.description;
            updatePaginationDots();
        }

        /**
         * Updates the pagination dots to reflect the current banner.
         */
        function updatePaginationDots() {
            paginationDotsContainer.innerHTML = ''; // Clear existing dots
            heroBanners.forEach((_, index) => {
                const dot = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                dot.setAttribute('width', '24');
                dot.setAttribute('height', '24');
                dot.setAttribute('viewBox', '0 0 24 24');
                dot.setAttribute('fill', 'none');
                dot.setAttribute('stroke', 'currentColor');
                dot.setAttribute('stroke-width', '2');
                dot.setAttribute('stroke-linecap', 'round');
                dot.setAttribute('stroke-linejoin', 'round');
                dot.classList.add('w-2', 'h-2', 'text-white', 'cursor-pointer');
                dot.innerHTML = '<circle cx="12" cy="12" r="10"></circle>'; // Circle SVG path

                if (currentBannerIndex === index) {
                    dot.classList.add('fill-current', 'opacity-70');
                } else {
                    dot.classList.add('opacity-40');
                }
                dot.addEventListener('click', () => {
                    currentBannerIndex = index;
                    renderBanner();
                    resetAutoSlide();
                });
                paginationDotsContainer.appendChild(dot);
            });
        }

        /**
         * Navigates to the previous banner.
         */
        function handlePrevBanner() {
            currentBannerIndex = (currentBannerIndex === 0) ? heroBanners.length - 1 : currentBannerIndex - 1;
            renderBanner();
            resetAutoSlide();
        }

        /**
         * Navigates to the next banner.
         */
        function handleNextBanner() {
            currentBannerIndex = (currentBannerIndex === heroBanners.length - 1) ? 0 : currentBannerIndex + 1;
            renderBanner();
            resetAutoSlide();
        }

        /**
         * Resets the automatic banner slide interval.
         */
        function resetAutoSlide() {
            clearInterval(autoSlideInterval);
            autoSlideInterval = setInterval(handleNextBanner, 5000); // 5 seconds
        }

        /**
         * Handles scroll event to change header style.
         */
        function handleScroll() {
            const isScrolled = window.scrollY > 50;
            header.classList.toggle('bg-white', isScrolled);
            header.classList.toggle('shadow-sm', isScrolled);

            // Update logo color
            header.querySelector('a.text-2xl').classList.toggle('text-teal-500', isScrolled);
            header.querySelector('a.text-2xl').classList.toggle('text-white', !isScrolled);

            // Update nav links color
            header.querySelectorAll('nav a').forEach(link => {
                link.classList.toggle('text-gray-700', isScrolled);
                link.classList.toggle('text-white', !isScrolled);
                link.classList.toggle('hover:text-teal-600', isScrolled);
                link.classList.toggle('hover:text-gray-300', !isScrolled);
            });

            // Update search icon color
            const searchButton = document.querySelector('header .flex.items-center.space-x-4:last-child button');
            if (searchButton) {
                searchButton.classList.toggle('text-gray-600', isScrolled);
                searchButton.classList.toggle('text-white', !isScrolled);
                searchButton.classList.toggle('hover:text-teal-600', isScrolled);
                searchButton.classList.toggle('hover:text-gray-300', !isScrolled);
            }

            // Update user nickname color and dropdown icon color
            userNicknameSpan.classList.toggle('text-gray-700', isScrolled);
            userNicknameSpan.classList.toggle('text-white', !isScrolled);
            if (dropdownArrowIcon) {
                dropdownArrowIcon.classList.toggle('text-gray-700', isScrolled);
                dropdownArrowIcon.classList.toggle('text-white', !isScrolled);
            }

            // Update login/signup button style if it's visible
            if (!loginSignupBtn.classList.contains('hidden')) {
                loginSignupBtn.classList.toggle('text-teal-600', isScrolled);
                loginSignupBtn.classList.toggle('text-white', !isScrolled);
                loginSignupBtn.classList.toggle('border-teal-600', isScrolled);
                loginSignupBtn.classList.toggle('border-white', !isScrolled);
                loginSignupBtn.classList.toggle('hover:bg-teal-50', isScrolled);
                loginSignupBtn.classList.toggle('hover:bg-white', !isScrolled);
            }
        }

        /**
         * Handles touch start event for swipe.
         * @param {TouchEvent} e - The touch event.
         */
        function handleTouchStart(e) {
            touchStartX = e.touches[0].clientX;
        }

        /**
         * Handles touch move event for swipe.
         * @param {TouchEvent} e - The touch event.
         */
        function handleTouchMove(e) {
            touchEndX = e.touches[0].clientX;
        }

        /**
         * Handles touch end event for swipe and determines swipe direction.
         */
        function handleTouchEnd() {
            const swipeDistance = touchStartX - touchEndX;
            const minSwipeDistance = 50; // Minimum distance for a recognized swipe

            if (swipeDistance > minSwipeDistance) {
                // Swiped left (next banner)
                handleNextBanner();
            } else if (swipeDistance < -minSwipeDistance) {
                // Swiped right (previous banner)
                handlePrevBanner();
            }
        }

        /**
         * Renders the popular anime section.
         */
        function renderPopularAnime() {
            popularAnimeContainer.innerHTML = ''; // Clear existing items
            popularAnime.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex-shrink-0 w-52 md:w-60 lg:w-72 cursor-pointer flex flex-col';
                div.innerHTML = `
                    <div class="relative">
                        <img src="${item.img}" alt="${item.title}" class="w-full h-auto object-cover" onerror="this.onerror=null;this.src='https://placehold.co/200x112/CCCCCC/333333?text=Image+Error';"/>
                    </div>
                    <div class="flex items-start pt-2">
                        <div class="text-5xl font-extrabold text-black mr-2">${item.rank}</div>
                        <div class="flex-1">
                            <h3 class="text-base md:text-lg font-bold text-gray-900 truncate mb-1">${item.title}</h3>
                            <p class="text-sm text-gray-600 line-clamp-2">${item.description}</p>
                        </div>
                    </div>
                `;
                popularAnimeContainer.appendChild(div);
            });
        }

        /**
         * Renders the exclusive works section.
         */
        function renderExclusiveWorks() {
            exclusiveWorksContainer.innerHTML = ''; // Clear existing items
            exclusiveWorks.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex-shrink-0 w-52 md:w-60 lg:w-72 cursor-pointer';
                div.innerHTML = `
                    <div class="relative">
                        <img src="${item.img}" alt="${item.title}" class="w-full h-auto object-cover" onerror="this.onerror=null;this.src='https://placehold.co/200x112/CCCCCC/333333?text=Image+Error';"/>
                        </div>
                    <div class="pt-2">
                        <h3 class="text-base md:text-lg font-bold text-gray-900 truncate">
                            ${item.title}
                        </h3>
                    </div>
                `;
                exclusiveWorksContainer.appendChild(div);
            });
        }

        /**
         * Handles tab clicks for popular works section.
         * @param {Event} event - The click event.
         */
        function handleTabClick(event) {
            tabButtons.forEach(button => {
                button.classList.remove('text-teal-600', 'border-b-2', 'border-teal-600');
                button.classList.add('text-gray-600', 'hover:text-teal-600');
            });
            event.target.classList.add('text-teal-600', 'border-b-2', 'border-teal-600');
            event.target.classList.remove('text-gray-600', 'hover:text-teal-600');
            // In a real app, you would fetch/filter data based on the active tab here
            // For this example, we just change the active state.
        }

        /**
         * Updates the header's authentication section based on user login status.
         * @param {Object|null} user - The Firebase User object or null if logged out.
         */
        async function updateAuthSection(user) {
            if (user) {
                // User is logged in
                loginSignupBtn.classList.add('hidden'); // 로그인/회원가입 버튼 숨김
                userInfoDisplay.classList.remove('hidden');
                userInfoDisplay.classList.add('flex'); // 레이아웃을 위해 flex로 설정

                // Fetch user's nickname from Firestore
                const userProfileRef = doc(db, `artifacts/${appId}/users/${user.uid}/userProfiles`, user.uid);
                try {
                    const docSnap = await getDoc(userProfileRef);
                    if (docSnap.exists()) {
                        const userData = docSnap.data();
                        userNicknameSpan.textContent = userData.nickname || user.email; // 닉네임 또는 이메일 표시
                    } else {
                        userNicknameSpan.textContent = user.email || '사용자'; // 이메일 또는 일반적인 사용자명으로 폴백
                    }
                } catch (error) {
                    console.error("Error fetching user profile:", error);
                    userNicknameSpan.textContent = user.email || '사용자'; // 오류 시 폴백
                }
            } else {
                // User is logged out
                loginSignupBtn.classList.remove('hidden'); // 로그인/회원가입 버튼 표시
                userInfoDisplay.classList.add('hidden');
                userInfoDisplay.classList.remove('flex');
                userNicknameSpan.textContent = '';
                userDropdownMenu.classList.add('hidden'); // 로그아웃 시 드롭다운 메뉴 숨김
                if (dropdownArrowIcon) {
                    dropdownArrowIcon.classList.remove('rotate-180'); // 화살표 아이콘 회전 초기화
                }
            }
            // 가시성 업데이트 후 스크롤 기반 스타일 다시 적용
            handleScroll();
        }

        // Firebase Auth State Listener
        onAuthStateChanged(auth, (user) => {
            updateAuthSection(user);
        });

        // Handle Login/Signup Button Click
        loginSignupBtn.addEventListener('click', () => {
            window.location.href = 'login.html'; // 로그인 페이지로 리디렉션
        });

        // Handle Dropdown Toggle Button Click
        dropdownToggleBtn.addEventListener('click', (event) => {
            event.stopPropagation(); // 클릭 이벤트가 문서로 버블링되는 것을 방지
            userDropdownMenu.classList.toggle('hidden');
            if (dropdownArrowIcon) {
                dropdownArrowIcon.classList.toggle('rotate-180'); // 화살표 아이콘 회전 토글
            }
        });

        // Handle Logout Button Click (inside dropdown)
        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                console.log("User signed out successfully.");
                // onAuthStateChanged 리스너에 의해 updateAuthSection이 호출될 것임
            } catch (error) {
                console.error("Error signing out:", error);
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (event) => {
            if (!userDropdownMenu.contains(event.target) && !dropdownToggleBtn.contains(event.target)) {
                userDropdownMenu.classList.add('hidden');
                if (dropdownArrowIcon) {
                    dropdownArrowIcon.classList.remove('rotate-180'); // 화살표 아이콘 회전 초기화
                }
            }
        });


        // Event Listeners
        window.addEventListener('load', () => {
            renderBanner(); // 배너 초기 렌더링
            resetAutoSlide(); // 자동 슬라이드 시작
            renderPopularAnime(); // 인기 작품 섹션 렌더링
            renderExclusiveWorks(); // 최신 작품 섹션 렌더링
            // 초기 위치에 따라 헤더 스타일을 설정하기 위한 handleScroll 초기 호출
            handleScroll();
        });

        window.addEventListener('scroll', handleScroll);
        prevBannerBtn.addEventListener('click', handlePrevBanner);
        nextBannerBtn.addEventListener('click', handleNextBanner);

        heroSection.addEventListener('touchstart', handleTouchStart);
        heroSection.addEventListener('touchmove', handleTouchMove);
        heroSection.addEventListener('touchend', handleTouchEnd);

        tabButtons.forEach(button => {
            button.addEventListener('click', handleTabClick);
        });

    </script>
</body>
</html>
